{% extends '_layout.html' %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link" href="/">홈</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/addpost">게시글 추가</a>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <img src="{{ user.profile_pic.url }}" width="30rem" class="d-inline-block rounded-circle" alt="">
        </a>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/mypage">프로필</a></li>
            <li><a class="dropdown-item" href="#">설정</a></li>
            <li>
                <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="/logout">로그아웃</a></li>
        </ul>
    </li>
{% endblock %}

{% block content %}
    <section class="container">
        <div class="post-content content">
            <div class="left left-margin post-img">
                <div class="border rounded-3" style="width: 100%;">
                    <div style="position: relative; padding-top: 100%; overflow: hidden">
                        <img style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;" src="{{ post.image.url }}" alt="">
                    </div>
                </div>
{#                <img src="{{ post.image.url }}" alt="">#}
            </div>
            <div class="left cont">
                <div>
                    <!-- 설명 -->
                    <ul class="navbar navbar-light navbar-expand-lg navbar-light" style="margin-bottom: -.2rem;">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <img src="{{ post.author.profile_pic.url }}" style="border-radius: 20px; margin-left: -3rem;" width="30rem" class="d-inline-block" alt="">
                                <b class="user" style="color: black;">&nbsp;{{ post.author.nickname }}</b>
                            </a>
                        </li>
                        <li>
                            <p style="padding-top: .6rem; text-align: center;">

                            </p>
                        </li>
                        <li class="nav-item dropdown ms-auto" style="padding-bottom: .5rem;">
                            <a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                <i class="fas fa-caret-down" style="color: #8E8E8E;"></i>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" href="/editpost?id={{ post.id }}">수정</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#">삭제</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div>
                    <div>
                        <!-- 댓글 -->
                        <!-- 설명 -->
                        <div class="commet" style="overflow:auto;">
                            <p class="explanation" style="color: black;">
                                <a href="#">
                                    <img src="{{ post.author.profile_pic.url }}" style="border-radius: 20px;" width="30rem" class="d-inline-block" alt="">
                                    <b class="user" style="color: black;">&nbsp;{{ post.author.nickname }}</b>
                                </a>
                                &nbsp;&nbsp;{{ post.description }}
                            </p>
                            <div id="comments"></div>
                                <div id="comment">
                                    <p class="sympathy" style="color: black;">
                                        <a href="#">
                                            <img src="./image/profil.png" style="border-radius: 20px;" width="30rem" class="d-inline-block" alt="">
                                            <strong class="user" style="color: black;">&nbsp;redesigned</strong>
                                        </a>
                                        &nbsp;&nbsp;ㅁㄴㅇㄹ
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div>
                            <p style="font-size: 9px; color: #8E8E8E; margin-top: .2rem; margin-bottom: auto;">
                                &nbsp;&nbsp;{{ post.created_at.date }}
                            </p>
                        </div>
                        <div class="lov" style="margin: .3rem;">
                            <a><i class="far fa-heart fa-sm"></i></a>
                        </div>

                        <div class="commen">
                            <form class="form-inline" method="post">
                                {% csrf_token %}
                                <div class="input-group">
                                    <input id="comment-input" type="text" class="form-control" placeholder="댓글 달기" />
                                    <button id="submit" type="button" style="width: 70px;" disabled>게시</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function () {
                $('#comment-input').on('input change', function () {
                    if ($(this).val().length > 0) {
                        document.getElementById('submit').style.color = "#0095f6"
                        $('#submit').prop('disabled', false);
                    } else {
                        document.getElementById('submit').style.color = "#B7E1FD"
                        $('#submit').prop('disabled', true);
                    }
                });
            });
        </script>
        <script src="/static/jquery/jquery-3.2.1.min.js"></script>
        <script>
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>
        <script>
            function ajaxLogin() {
                const submitBtn = $('#submit')
                submitBtn.prop('disabled', true);

                const email = $('#comment-input').val()
                if(email.length > 3 && password.length > 0) {
                    $.ajax({
                        type: 'POST',
                        url:'/login',
                        data: {
                            'csrfmiddlewaretoken': getCookie('csrftoken'),
                            'email': email,
                            'password': password
                        },
                        success:function(res){
                            if(res.msg === "success"){
                                location.href = "/"
                            }
                            else if(res.msg === "id_fail") {
                                alert("wrong email")
                            } else if(res.msg === "pw_fail") {
                                alert("wrong password")
                            }
                            $('#password').value = ""
                        }
                    })
                }
                submitBtn.prop('disabled', false);
            }
        </script>
    </section>
{% endblock %}